<!DOCTYPE html>
<html>
<head>
    <title>Phase 4 Test</title>
</head>
<body>
    <h1>Phase 4 Browser Test</h1>
    <div id="output"></div>

    <script src="../dist/tagteam.js"></script>
    <script>
        const output = document.getElementById('output');

        function log(msg) {
            output.innerHTML += '<p>' + msg + '</p>';
            console.log(msg);
        }

        (async function() {
            try {
                log('TagTeam version: ' + TagTeam.version);
                log('Has buildGraph: ' + (typeof TagTeam.buildGraph));
                log('Has EntityExtractor: ' + (typeof TagTeam.EntityExtractor));

                // Check if nlp (Compromise) is available
                log('window.nlp available: ' + (typeof window.nlp));

                // Load tree models
                log('Loading models...');
                try {
                    const [posRes, depRes] = await Promise.all([
                        fetch('../dist/models/pos-weights-pruned.json'),
                        fetch('../dist/models/dep-weights-pruned.json')
                    ]);
                    const posJSON = await posRes.json();
                    const depJSON = await depRes.json();
                    TagTeam.loadModels(posJSON, depJSON);
                    log('Models loaded. areModelsLoaded: ' + TagTeam.areModelsLoaded());
                } catch (e) {
                    log('Model loading failed: ' + e.message + ' â€” falling back to legacy');
                }

                // Try building a graph
                var opts = {};
                if (!TagTeam.areModelsLoaded()) opts.useLegacy = true;
                const result = TagTeam.buildGraph('The doctor must allocate the ventilator', opts);
                log('Graph built successfully!');
                log('Node count: ' + result['@graph'].length);

                // Check for Tier 2 entities
                const tier2 = result['@graph'].filter(n =>
                    n['@type'] && (n['@type'].includes('cco:Person') || n['@type'].includes('cco:Artifact'))
                );
                log('Tier 2 entities: ' + tier2.length);

                // Check for is_about links
                const hasIsAbout = result['@graph'].some(n => n['cco:is_about']);
                log('Has cco:is_about links: ' + hasIsAbout);

                // Show full JSON
                log('<pre>' + JSON.stringify(result, null, 2) + '</pre>');

            } catch (e) {
                log('ERROR: ' + e.message);
                log('<pre>' + e.stack + '</pre>');
            }
        })();
    </script>
</body>
</html>
