<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TagTeam.js - Ethical Context Analysis Library</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 60px 20px;
        }

        header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header .version {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        header p {
            font-size: 1.3em;
            margin-bottom: 30px;
            opacity: 0.95;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .demo-section {
            margin-bottom: 50px;
        }

        .demo-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .interactive-demo {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .example-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            font-size: 14px;
        }

        .example-btn:hover {
            background: #667eea;
            color: white;
        }

        .results {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid #27ae60;
        }

        .results h3 {
            color: #27ae60;
            margin-bottom: 15px;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .links-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .link-card {
            background: white;
            border: 2px solid #667eea;
            padding: 20px 30px;
            border-radius: 10px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s;
        }

        .link-card:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        footer {
            text-align: center;
            color: white;
            padding: 30px;
            opacity: 0.9;
        }

        .badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.85em;
            margin-left: 10px;
            font-weight: 600;
        }

        .context-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .context-category {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .context-category h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .context-dimension {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9em;
        }

        .dimension-value {
            font-weight: 600;
            color: #27ae60;
        }

        /* Phase 4 JSON-LD Styles */
        .phase4-section {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
        }

        .phase4-section h3 {
            color: white;
            margin-bottom: 15px;
        }

        .phase4-section p {
            color: rgba(255,255,255,0.9);
        }

        .phase4-btn {
            background: white;
            color: #7c3aed;
            border: none;
            padding: 12px 24px;
            font-size: 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .phase4-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }

        .phase4-results {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid #8b5cf6;
        }

        .phase4-results h3 {
            color: #7c3aed;
            margin-bottom: 15px;
        }

        .graph-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .summary-stat {
            background: #f5f3ff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-stat .number {
            font-size: 2em;
            font-weight: bold;
            color: #7c3aed;
        }

        .summary-stat .label {
            font-size: 0.85em;
            color: #6b7280;
        }

        .entity-list, .act-list, .role-list {
            margin: 15px 0;
        }

        .entity-item, .act-item, .role-item {
            background: #f5f3ff;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #8b5cf6;
        }

        .badge-phase4 {
            background: #8b5cf6;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>TagTeam.js</h1>
            <span class="version">v6.6</span>
            <p>Two-Tier Semantic Graph Architecture with Custom Ontology Tagging</p>
            <div class="hero-stats">
                <div class="stat">
                    <span class="stat-number">800+</span>
                    <span class="stat-label">Tests Passing</span>
                </div>
                <div class="stat">
                    <span class="stat-number">2-Tier</span>
                    <span class="stat-label">Architecture</span>
                </div>
                <div class="stat">
                    <span class="stat-number">BFO/CCO</span>
                    <span class="stat-label">Compatible</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <section class="demo-section">
                <h2>üöÄ Try It Live</h2>
                <p>Enter any ethical scenario or moral dilemma to see TagTeam.js analyze its context:</p>

                <div class="interactive-demo">
                    <textarea id="input" placeholder="Enter an ethical scenario...">The doctor must allocate the last ventilator between two critically ill patients</textarea>

                    <button onclick="analyze()">Analyze Context</button>

                    <h4 style="margin-top: 25px; margin-bottom: 10px; color: #666;">Quick Examples:</h4>
                    <div class="example-buttons">
                        <button class="example-btn" onclick="setExample('The family must decide whether to continue treatment')">Healthcare</button>
                        <button class="example-btn" onclick="setExample('I am questioning core doctrines')">Spiritual</button>
                        <button class="example-btn" onclick="setExample('I discovered that my company is falsifying safety reports')">Whistleblowing</button>
                        <button class="example-btn" onclick="setExample('My best friend is cheating on their spouse')">Interpersonal</button>
                        <button class="example-btn" onclick="setExample('Should I report my colleague for minor policy violations?')">Professional</button>
                    </div>

                    <div id="results" style="display: none;">
                        <div class="results">
                            <h3>Analysis Results</h3>
                            <div id="context-breakdown"></div>
                            <details style="margin-top: 20px;">
                                <summary style="cursor: pointer; font-weight: 600; color: #667eea;">View Full JSON Output</summary>
                                <pre id="json-output"></pre>
                            </details>
                        </div>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>üß† Phase 4: Two-Tier Semantic Graph <span class="badge badge-phase4">v2.2</span></h2>
                <p>Build BFO/CCO-compliant knowledge graphs with Two-Tier Architecture:</p>
                <ul style="margin: 15px 0 20px 25px; line-height: 1.8;">
                    <li><strong>Tier 1 (ICE):</strong> DiscourseReferent - what the text says</li>
                    <li><strong>Tier 2 (IC):</strong> Person/Artifact/Organization - real-world entities</li>
                    <li><strong>Cross-tier linking:</strong> <code>cco:is_about</code> connects parsing to semantics</li>
                    <li><strong>ActualityStatus:</strong> Prescribed, Actual, Permitted, Negated, etc.</li>
                </ul>

                <div class="phase4-section">
                    <h3>Try the Two-Tier JSON-LD Graph Builder</h3>
                    <p>Enter text below to generate a semantic knowledge graph with Tier 1 and Tier 2 entities:</p>
                    <br>
                    <textarea id="phase4-input" placeholder="Enter text to build a semantic graph..." style="min-height: 80px;">The doctor must allocate the last ventilator between two critically ill patients</textarea>
                    <br>
                    <button class="phase4-btn" onclick="buildGraph()">Build JSON-LD Graph</button>
                    <button class="phase4-btn" onclick="showGraphSummary()">Show Two-Tier Summary</button>
                </div>

                <div id="phase4-results" style="display: none;">
                    <div class="phase4-results">
                        <h3>Graph Analysis</h3>
                        <div id="graph-summary"></div>
                        <details style="margin-top: 20px;">
                            <summary style="cursor: pointer; font-weight: 600; color: #7c3aed;">View Full JSON-LD Output</summary>
                            <pre id="jsonld-output"></pre>
                        </details>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>‚ú® Key Features</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üéØ</div>
                        <h3>Context Intensity Analysis</h3>
                        <p>12-dimension analysis across temporal, relational, consequential, and epistemic categories</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üî¨</div>
                        <h3>Deterministic Parsing</h3>
                        <p>Pattern-based keyword matching with negation and intensifier detection - no AI required</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üåê</div>
                        <h3>BFO Compatible</h3>
                        <p>Built on Basic Formal Ontology (ISO/IEC 21838-2) for interoperability with scientific ontologies</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üì¶</div>
                        <h3>Zero Dependencies</h3>
                        <p>Lightweight bundle with optional N3.js for ontology parsing - production-ready manifests require no runtime parsing</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>Fast Performance</h3>
                        <p>Parse typical scenarios in &lt;50ms with pre-compiled JSON ontology manifests</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üîß</div>
                        <h3>Extensible</h3>
                        <p>Custom ontologies via Turtle (TTL) format with semantic expansion from external hierarchies</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üîç</div>
                        <h3>Ambiguity Detection</h3>
                        <p>Identifies modal force, scope, nominalization, and selectional constraint ambiguities for downstream resolution</p>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">üìù</div>
                        <h3>NLP Foundation</h3>
                        <p>Custom lemmatizer, contraction expander, and phrase extractors - zero external NLP dependencies</p>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>üìä What Gets Analyzed</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <h3>‚è±Ô∏è Temporal Context</h3>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Urgency:</strong> Time pressure</li>
                            <li><strong>Duration:</strong> Impact timeline</li>
                            <li><strong>Reversibility:</strong> Can it be undone?</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h3>üë• Relational Context</h3>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Intimacy:</strong> Relationship closeness</li>
                            <li><strong>Power Differential:</strong> Authority gaps</li>
                            <li><strong>Trust:</strong> Relationship confidence</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h3>‚öñÔ∏è Consequential Context</h3>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Harm Severity:</strong> Potential damage</li>
                            <li><strong>Benefit Magnitude:</strong> Potential good</li>
                            <li><strong>Scope:</strong> Number affected</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h3>üß† Epistemic Context</h3>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Certainty:</strong> Confidence level</li>
                            <li><strong>Information Completeness:</strong> Data availability</li>
                            <li><strong>Expertise:</strong> Skill requirements</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>üîó Explore More</h2>
                <div class="links-section">
                    <a href="https://github.com/Skreen5hot/TagTeam.js" class="link-card" target="_blank">
                        üìñ GitHub Repository
                    </a>
                    <a href="phase66-custom-tagger-demo.html" class="link-card" style="background: linear-gradient(90deg, #a855f7, #ec4899); color: #fff; border: none;">
                        üè∑Ô∏è Phase 6.6: Custom Ontology Tagger
                    </a>
                    <a href="phase65-ontology-demo.html" class="link-card" style="background: linear-gradient(90deg, #f7971e, #ffd200); color: #1a1a2e; border: none;">
                        üåê Phase 6.5: Ontology Loading
                    </a>
                    <a href="phase6-lattice-demo.html" class="link-card" style="background: linear-gradient(90deg, #00d9ff, #00ff88); color: #1a1a2e; border: none;">
                        üß† Phase 6: Interpretation Lattice
                    </a>
                    <a href="stakeholder-demo.html" class="link-card">
                        üéØ Stakeholder Demo
                    </a>
                    <a href="semantic-demo.html" class="link-card">
                        üî¨ Semantic Role Demo
                    </a>
                    <a href="separated-demo.html" class="link-card">
                        üì¶ Separated Bundles Demo
                    </a>
                    <a href="validation.html" class="link-card">
                        ‚úÖ Validation Tests
                    </a>
                </div>
            </section>

            <section class="demo-section">
                <h2>üèóÔ∏è Current Development</h2>
                <p><strong>Phase 6.5 Ontology Loading:</strong> <span class="badge" style="background: #10b981;">COMPLETE</span></p>
                <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                    <li>‚úÖ Phase 6.5.1: TurtleParser - Lightweight TTL/Turtle parser (80 tests)</li>
                    <li>‚úÖ Phase 6.5.2: OntologyManager - Unified JSON + TTL loading with caching (80 tests)</li>
                    <li>‚úÖ Phase 6.5.3: ValueNetAdapter - ValueNet &#x2192; ValueMatcher conversion (50 tests)</li>
                    <li>‚úÖ Phase 6.5.4: BridgeOntologyLoader - IEE bridge ontology support (54 tests)</li>
                    <li>‚úÖ Phase 6.6: OntologyTextTagger - Custom ontology text tagging (64 tests)</li>
                    <li>‚úÖ <strong>800+ unit tests passing</strong> (100% pass rate)</li>
                </ul>

                <div style="margin-top: 20px; padding: 15px; background: #e0f2fe; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                    <h4 style="color: #0284c7; margin-bottom: 10px;">Phase 6 Interpretation Lattice Highlights</h4>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li><strong>Hierarchy of Evidence:</strong> Selectional match (0.99) ‚Üí Intensifiers ‚Üí Structural signals</li>
                        <li><strong>Plausibility Scores:</strong> Default 70%, alternatives split 30%</li>
                        <li><strong>Modal Strength Scale:</strong> Adverbial intensifiers modulate readings</li>
                        <li><strong>Metonymic Bridge:</strong> Location re-typed as cco:Organization</li>
                        <li><strong>Audit Trail:</strong> Full resolution reasoning via getResolutionReasoning()</li>
                        <li><strong>Backwards Compatible:</strong> toSimplifiedGraph() returns default only</li>
                    </ul>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
                    <h4 style="color: #059669; margin-bottom: 10px;">Phase 5 Ambiguity Detection</h4>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li><strong>Noun Category:</strong> Process vs continuant for nominalizations</li>
                        <li><strong>Modal Force:</strong> Deontic vs epistemic disambiguation</li>
                        <li><strong>Scope Ambiguity:</strong> Quantifier + negation scope</li>
                        <li><strong>Selectional Violations:</strong> Inanimate agents flagged</li>
                    </ul>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f5f3ff; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                    <h4 style="color: #7c3aed; margin-bottom: 10px;">Phase 4 Two-Tier Architecture</h4>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li><strong>Tier 1 (ICE Layer):</strong> DiscourseReferent with sourceText, positions</li>
                        <li><strong>Tier 2 (IC Layer):</strong> cco:Person, cco:Artifact, cco:Organization</li>
                        <li><strong>Cross-tier:</strong> <code>cco:is_about</code> links referents to entities</li>
                        <li><strong>ActualityStatus:</strong> Prescribed, Actual, Permitted, Negated</li>
                    </ul>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <h4 style="color: #b45309; margin-bottom: 10px;">Phase 6.5 Ontology Loading Highlights</h4>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li><strong>TurtleParser:</strong> Lightweight TTL parser for ValueNet ontologies</li>
                        <li><strong>OntologyManager:</strong> Unified JSON + TTL loading with caching and merge</li>
                        <li><strong>ValueNetAdapter:</strong> keywords &#x2192; semanticMarkers, upholdingTerms &#x2192; polarityIndicators</li>
                        <li><strong>BridgeOntologyLoader:</strong> owl:sameAs, ethics:relatedTo, ethics:mapsToWorldview</li>
                        <li><strong>Full Pipeline:</strong> TagTeam &#x2192; ValueNet &#x2192; IEE worldview mapping chains</li>
                    </ul>
                </div>

                <p style="margin-top: 20px;"><strong>Coming Next:</strong> Phase 7 - Epistemic Layer</p>
            </section>
        </div>
    </div>

    <footer>
        <div class="container">
            <p><strong>TagTeam.js</strong> - Built with ‚ù§Ô∏è for ethical AI and moral reasoning applications</p>
            <p style="margin-top: 10px; font-size: 0.9em;">MIT License | BFO-Compatible | 100% Deterministic</p>
        </div>
    </footer>

    <!-- Load TagTeam.js -->
    <script>
        const scriptPath = window.location.hostname === 'localhost' || window.location.hostname === ''
            ? '../dist/tagteam.js'
            : 'tagteam.js';
        document.write('<script src="' + scriptPath + '"><\/script>');
    </script>

    <script>
        function setExample(text) {
            document.getElementById('input').value = text;
            analyze();
        }

        function analyze() {
            const text = document.getElementById('input').value;
            if (!text.trim()) {
                alert('Please enter some text to analyze');
                return;
            }

            const result = TagTeam.parse(text);

            // Show results section
            document.getElementById('results').style.display = 'block';

            // Display full JSON
            document.getElementById('json-output').textContent = JSON.stringify(result, null, 2);

            // Display context breakdown
            const breakdownDiv = document.getElementById('context-breakdown');
            if (result.contextIntensity) {
                let html = '<div class="context-breakdown">';

                for (const category in result.contextIntensity) {
                    html += `<div class="context-category">`;
                    html += `<h4>${category.charAt(0).toUpperCase() + category.slice(1)}</h4>`;

                    for (const dimension in result.contextIntensity[category]) {
                        const value = result.contextIntensity[category][dimension];
                        html += `<div class="context-dimension">`;
                        html += `<span>${dimension}</span>`;
                        html += `<span class="dimension-value">${value.toFixed(2)}</span>`;
                        html += `</div>`;
                    }

                    html += `</div>`;
                }

                html += '</div>';
                breakdownDiv.innerHTML = html;
            } else {
                breakdownDiv.innerHTML = '<p style="color: #e74c3c;">No context intensity data found in result.</p>';
            }

            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Auto-analyze on page load if there's default text
        window.onload = function() {
            const input = document.getElementById('input');
            if (input.value.trim()) {
                analyze();
            }
        };

        // Phase 4: JSON-LD Graph Functions
        function buildGraph() {
            const text = document.getElementById('phase4-input').value;
            if (!text.trim()) {
                alert('Please enter some text to build a graph');
                return;
            }

            const jsonld = TagTeam.toJSONLD(text, { pretty: true, detectAmbiguity: true });

            document.getElementById('phase4-results').style.display = 'block';
            document.getElementById('jsonld-output').textContent = jsonld;
            document.getElementById('graph-summary').innerHTML = '<p>JSON-LD graph generated with ambiguity detection. Click "Show Summary" for details.</p>';

            document.getElementById('phase4-results').scrollIntoView({ behavior: 'smooth' });
        }

        function showGraphSummary() {
            const text = document.getElementById('phase4-input').value;
            if (!text.trim()) {
                alert('Please enter some text to analyze');
                return;
            }

            const graph = TagTeam.buildGraph(text, { detectAmbiguity: true });
            const jsonld = TagTeam.toJSONLD(text, { pretty: true, detectAmbiguity: true });

            // Two-Tier Architecture: Tier 1 (DiscourseReferent) and Tier 2 (Person/Artifact)
            const tier1Referents = graph['@graph'].filter(n =>
                n['@type'] && n['@type'].includes('tagteam:DiscourseReferent'));
            const tier2Entities = graph['@graph'].filter(n =>
                n['@type'] && (n['@type'].includes('cco:Person') ||
                               n['@type'].includes('cco:Artifact') ||
                               n['@type'].includes('cco:Organization')));
            const acts = graph['@graph'].filter(n =>
                n['@type'] && n['@type'].some(t => t.includes('IntentionalAct') || t.includes('ActOf')));
            const roles = graph['@graph'].filter(n =>
                n['@type'] && n['@type'].includes('bfo:BFO_0000023'));

            let html = `
                <div class="graph-summary">
                    <div class="summary-stat">
                        <div class="number">${graph['@graph'].length}</div>
                        <div class="label">Total Nodes</div>
                    </div>
                    <div class="summary-stat">
                        <div class="number">${tier1Referents.length}</div>
                        <div class="label">Tier 1 Referents</div>
                    </div>
                    <div class="summary-stat">
                        <div class="number">${tier2Entities.length}</div>
                        <div class="label">Tier 2 Entities</div>
                    </div>
                    <div class="summary-stat">
                        <div class="number">${acts.length}</div>
                        <div class="label">Acts</div>
                    </div>
                </div>
            `;

            // Tier 1: Discourse Referents (ICE Layer)
            if (tier1Referents.length > 0) {
                html += '<h4 style="color: #7c3aed; margin-top: 20px;">üìù Tier 1: Discourse Referents (ICE Layer)</h4><div class="entity-list">';
                tier1Referents.forEach(r => {
                    let extras = '';
                    if (r['tagteam:is_scarce']) extras += ' <strong style="color: #dc2626;">‚ö†Ô∏è SCARCE</strong>';
                    const isAbout = r['cco:is_about'] ? ` ‚Üí <em style="color: #059669;">${r['cco:is_about'].split('_').slice(0,2).join('_')}</em>` : '';
                    html += `<div class="entity-item"><strong>${r['rdfs:label']}</strong>${isAbout}${extras}</div>`;
                });
                html += '</div>';
            }

            // Tier 2: Real-World Entities (IC Layer)
            if (tier2Entities.length > 0) {
                html += '<h4 style="color: #059669; margin-top: 20px;">üåç Tier 2: Real-World Entities (IC Layer)</h4><div class="entity-list" style="border-left-color: #059669;">';
                tier2Entities.forEach(e => {
                    const entityType = e['@type'].find(t => t.startsWith('cco:')) || 'Entity';
                    html += `<div class="entity-item" style="border-left-color: #059669;"><strong>${e['rdfs:label']}</strong> (${entityType})</div>`;
                });
                html += '</div>';
            }

            // Acts with ActualityStatus
            if (acts.length > 0) {
                html += '<h4 style="color: #7c3aed; margin-top: 20px;">üé¨ Intentional Acts</h4><div class="act-list">';
                acts.forEach(a => {
                    const actType = a['@type'].find(t => t.includes('cco:')) || 'IntentionalAct';
                    let modality = a['tagteam:modality'] ? ` <em>[${a['tagteam:modality']}]</em>` : '';
                    let status = a['tagteam:actualityStatus'] ? ` <span style="background: #8b5cf6; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">${a['tagteam:actualityStatus'].replace('tagteam:', '')}</span>` : '';
                    let agent = a['cco:has_agent'] ? ` <span style="color: #059669; font-size: 0.9em;">agent: ${a['cco:has_agent'].split('_').slice(1,2).join('')}</span>` : '';
                    html += `<div class="act-item"><strong>${a['tagteam:verb']}</strong> (${actType})${modality}${status}${agent}</div>`;
                });
                html += '</div>';
            }

            if (roles.length > 0) {
                html += '<h4 style="color: #7c3aed; margin-top: 20px;">üé≠ BFO Roles</h4><div class="role-list">';
                roles.forEach(r => {
                    html += `<div class="role-item">${r['rdfs:label']}</div>`;
                });
                html += '</div>';
            }

            // Phase 5: Ambiguity Detection Results
            if (graph._ambiguityReport && graph._ambiguityReport.ambiguities && graph._ambiguityReport.ambiguities.length > 0) {
                html += '<h4 style="color: #f59e0b; margin-top: 20px;">üîç Detected Ambiguities (Phase 5)</h4>';
                html += '<div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">';

                graph._ambiguityReport.ambiguities.forEach(amb => {
                    const typeLabel = amb.type.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    const confidence = amb.confidence || 'medium';
                    const confidenceColor = confidence === 'high' ? '#dc2626' : confidence === 'medium' ? '#f59e0b' : '#6b7280';

                    html += `<div style="margin: 10px 0; padding: 10px; background: white; border-radius: 6px;">`;
                    html += `<strong style="color: #b45309;">${typeLabel}</strong>`;
                    html += ` <span style="background: ${confidenceColor}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.75em;">${confidence.toUpperCase()}</span>`;

                    if (amb.span) {
                        html += `<br><em style="color: #6b7280;">Span: "${amb.span}"</em>`;
                    }
                    if (amb.modal) {
                        html += `<br><span style="color: #7c3aed;">Modal: <strong>${amb.modal}</strong></span>`;
                    }
                    if (amb.readings && amb.readings.length > 0) {
                        html += `<br><span style="color: #059669;">Possible readings: ${amb.readings.join(' | ')}</span>`;
                    }
                    if (amb.defaultReading) {
                        html += `<br><span style="color: #2563eb;">Default: <strong>${amb.defaultReading}</strong></span>`;
                    }
                    if (amb.signals && amb.signals.length > 0) {
                        html += `<br><span style="color: #6b7280; font-size: 0.85em;">Signals: ${amb.signals.join(', ')}</span>`;
                    }

                    html += `</div>`;
                });

                html += '</div>';
            } else {
                html += '<h4 style="color: #10b981; margin-top: 20px;">‚úÖ No Ambiguities Detected</h4>';
                html += '<p style="color: #6b7280;">The input text has no detected linguistic ambiguities.</p>';
            }

            document.getElementById('phase4-results').style.display = 'block';
            document.getElementById('graph-summary').innerHTML = html;
            document.getElementById('jsonld-output').textContent = jsonld;

            document.getElementById('phase4-results').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
