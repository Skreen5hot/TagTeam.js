<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TagTeam.js - Phase 6.5: Ontology Loading Demo</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      min-height: 100vh;
      color: #e8e8e8;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2.5em;
      margin: 0;
      background: linear-gradient(90deg, #f7971e, #ffd200);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #888;
      font-size: 1.2em;
      margin-top: 10px;
    }

    .version-badge {
      display: inline-block;
      background: linear-gradient(90deg, #f7971e, #ffd200);
      color: #1a1a2e;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9em;
      margin-top: 15px;
    }

    .demo-section {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }

    .demo-section h2 {
      color: #f7971e;
      margin-top: 0;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .demo-section h2 .icon {
      font-size: 1.3em;
    }

    textarea {
      width: 100%;
      padding: 15px;
      font-size: 0.95em;
      border: 2px solid rgba(247,151,30,0.3);
      border-radius: 10px;
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-family: 'Consolas', 'Monaco', monospace;
      resize: vertical;
      min-height: 200px;
    }

    textarea:focus {
      outline: none;
      border-color: #f7971e;
      box-shadow: 0 0 20px rgba(247,151,30,0.2);
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(90deg, #f7971e, #ffd200);
      color: #1a1a2e;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(247,151,30,0.4);
    }

    .btn-example {
      background: rgba(255,255,255,0.1);
      color: #f7971e;
      border: 1px solid rgba(247,151,30,0.3);
    }

    .btn-example:hover {
      background: rgba(247,151,30,0.2);
    }

    .results {
      margin-top: 25px;
      display: none;
    }

    .results.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-card {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #f7971e;
    }

    .result-card h3 {
      margin: 0 0 15px 0;
      color: #ffd200;
      font-size: 1.1em;
    }

    .mapping-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 15px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .mapping-arrow {
      color: #f7971e;
      font-weight: bold;
      font-size: 1.2em;
    }

    .tag {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
    }

    .tag-tagteam { background: #667eea; color: white; }
    .tag-valuenet { background: #f7971e; color: #1a1a2e; }
    .tag-iee { background: #00ff88; color: #1a1a2e; }
    .tag-keyword { background: rgba(255,255,255,0.15); color: #ffd200; }
    .tag-upholding { background: rgba(0,255,136,0.2); color: #00ff88; }
    .tag-violating { background: rgba(255,107,107,0.2); color: #ff6b6b; }

    .stats-row {
      display: flex;
      gap: 30px;
      justify-content: center;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
    }

    .stat .number {
      font-size: 2.5em;
      font-weight: bold;
      background: linear-gradient(90deg, #f7971e, #ffd200);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat .label {
      color: #888;
      font-size: 0.9em;
    }

    .code-block {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Consolas', monospace;
      font-size: 0.9em;
      overflow-x: auto;
      border: 1px solid #30363d;
    }

    .code-block .keyword { color: #ff7b72; }
    .code-block .string { color: #a5d6ff; }
    .code-block .property { color: #79c0ff; }
    .code-block .comment { color: #8b949e; }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .feature-card {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .feature-card h4 {
      color: #f7971e;
      margin: 0 0 10px 0;
    }

    .feature-card p {
      color: #aaa;
      margin: 0;
      font-size: 0.95em;
      line-height: 1.5;
    }

    .json-output {
      background: #0d1117;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Consolas', monospace;
      font-size: 0.85em;
      overflow-x: auto;
      border: 1px solid #30363d;
      color: #e2e8f0;
      max-height: 400px;
      overflow-y: auto;
    }

    .pipeline-flow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin: 25px 0;
      flex-wrap: wrap;
    }

    .pipeline-step {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      padding: 15px 20px;
      text-align: center;
      min-width: 140px;
    }

    .pipeline-step .step-name {
      font-weight: bold;
      color: #ffd200;
      font-size: 0.95em;
    }

    .pipeline-step .step-detail {
      color: #888;
      font-size: 0.8em;
      margin-top: 5px;
    }

    .pipeline-arrow {
      color: #f7971e;
      font-size: 1.5em;
    }

    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      font-size: 0.9em;
    }

    footer a {
      color: #f7971e;
      text-decoration: none;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Ontology Loading</h1>
    <p class="subtitle">TTL Parsing, ValueNet Integration &amp; IEE Bridge Ontology</p>
    <span class="version-badge">Phase 6.5 - TagTeam.js v6.5.4</span>
  </header>

  <div class="stats-row">
    <div class="stat">
      <div class="number">264</div>
      <div class="label">New Tests</div>
    </div>
    <div class="stat">
      <div class="number">4</div>
      <div class="label">New Modules</div>
    </div>
    <div class="stat">
      <div class="number">TTL</div>
      <div class="label">Format Support</div>
    </div>
  </div>

  <!-- Feature Overview -->
  <div class="demo-section">
    <h2><span class="icon">&#x1F3AF;</span> What's New in Phase 6.5</h2>
    <p style="color: #aaa; margin-bottom: 20px;">
      Phase 6.5 adds <strong>ontology loading</strong> capabilities, enabling TagTeam to load ValueNet TTL files
      and map between TagTeam values, ValueNet dispositions, and IEE worldview categories.
    </p>

    <div class="pipeline-flow">
      <div class="pipeline-step">
        <div class="step-name">TTL File</div>
        <div class="step-detail">ValueNet Turtle</div>
      </div>
      <div class="pipeline-arrow">&#x2192;</div>
      <div class="pipeline-step">
        <div class="step-name">TurtleParser</div>
        <div class="step-detail">Parse triples</div>
      </div>
      <div class="pipeline-arrow">&#x2192;</div>
      <div class="pipeline-step">
        <div class="step-name">OntologyManager</div>
        <div class="step-detail">Load + cache</div>
      </div>
      <div class="pipeline-arrow">&#x2192;</div>
      <div class="pipeline-step">
        <div class="step-name">ValueNetAdapter</div>
        <div class="step-detail">Format conversion</div>
      </div>
      <div class="pipeline-arrow">&#x2192;</div>
      <div class="pipeline-step">
        <div class="step-name">ValueMatcher</div>
        <div class="step-detail">Detect values</div>
      </div>
    </div>

    <div class="feature-grid">
      <div class="feature-card">
        <h4>&#x1F4C4; TTL Parser</h4>
        <p>Lightweight Turtle/TTL parser. Extracts prefixes, triples, labels, keywords, and value definitions from RDF.</p>
      </div>
      <div class="feature-card">
        <h4>&#x1F4E6; OntologyManager</h4>
        <p>Unified loader supporting JSON + TTL formats with in-memory caching and merge strategy for overlapping definitions.</p>
      </div>
      <div class="feature-card">
        <h4>&#x1F504; ValueNet Adapter</h4>
        <p>Converts ontology keywords/upholdingTerms/violatingTerms to ValueMatcher's semanticMarkers/polarityIndicators.</p>
      </div>
      <div class="feature-card">
        <h4>&#x1F30D; Bridge Ontology</h4>
        <p>Maps TagTeam &#x2194; ValueNet &#x2194; IEE worldviews via owl:sameAs, ethics:relatedTo, and ethics:mapsToWorldview.</p>
      </div>
    </div>
  </div>

  <!-- TTL Parsing Demo -->
  <div class="demo-section">
    <h2><span class="icon">&#x1F9EA;</span> Demo 1: Parse ValueNet TTL</h2>
    <p style="color: #aaa; margin-bottom: 15px;">
      Enter a Turtle/TTL ontology definition to parse. The TurtleParser extracts prefixes, triples, and value definitions.
    </p>

    <textarea id="ttl-input">@prefix vn: <https://fandaws.com/ontology/bfo/valuenet#> .
@prefix bfo: <http://purl.obolibrary.org/obo/BFO_> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

vn:SecurityDisposition a bfo:0000016 ;
    rdfs:label "Security" ;
    vn:keywords "safety, stability, protection" ;
    vn:upholdingTerms "protect, secure, safeguard" ;
    vn:violatingTerms "endanger, threaten, risk" .

vn:AutonomyDisposition a bfo:0000016 ;
    rdfs:label "Autonomy" ;
    vn:keywords "choice, freedom, self-determination" ;
    vn:upholdingTerms "respect, empower, enable" ;
    vn:violatingTerms "coerce, force, manipulate" .

vn:BeneficenceDisposition a bfo:0000016 ;
    rdfs:label "Beneficence" ;
    vn:keywords "welfare, wellbeing, benefit, help" ;
    vn:upholdingTerms "care, support, assist" ;
    vn:violatingTerms "neglect, abandon, harm" .</textarea>

    <div class="btn-row">
      <button class="btn-primary" onclick="parseTTL()">Parse TTL</button>
      <button class="btn-example" onclick="loadTTLExample('valuenet')">ValueNet Example</button>
      <button class="btn-example" onclick="loadTTLExample('bridge')">Bridge Ontology</button>
    </div>

    <div id="ttl-results" class="results"></div>
  </div>

  <!-- Value Detection Demo -->
  <div class="demo-section">
    <h2><span class="icon">&#x1F50D;</span> Demo 2: Value Detection from Ontology</h2>
    <p style="color: #aaa; margin-bottom: 15px;">
      Load the ValueNet TTL above, convert to ValueMatcher format, and detect ethical values in text.
      Click "Load &amp; Detect" to run the full pipeline.
    </p>

    <textarea id="text-input" style="min-height: 80px;">We must protect the safety of vulnerable patients while respecting their autonomy and freedom of choice. Neglecting their welfare would be harmful.</textarea>

    <div class="btn-row">
      <button class="btn-primary" onclick="detectValues()">Load Ontology &amp; Detect Values</button>
      <button class="btn-example" onclick="setTextExample('upholding')">Upholding Example</button>
      <button class="btn-example" onclick="setTextExample('violating')">Violating Example</button>
      <button class="btn-example" onclick="setTextExample('mixed')">Mixed Polarity</button>
    </div>

    <div id="value-results" class="results"></div>
  </div>

  <!-- Bridge Ontology Demo -->
  <div class="demo-section">
    <h2><span class="icon">&#x1F30D;</span> Demo 3: Bridge Ontology Mapping</h2>
    <p style="color: #aaa; margin-bottom: 15px;">
      Load a bridge ontology that maps TagTeam values to ValueNet dispositions and IEE worldview categories.
      Demonstrates the complete mapping chain.
    </p>

    <div class="btn-row">
      <button class="btn-primary" onclick="demoBridge()">Load Bridge &amp; Show Mappings</button>
    </div>

    <div id="bridge-results" class="results"></div>
  </div>

  <!-- Code Examples -->
  <div class="demo-section">
    <h2><span class="icon">&#x1F527;</span> How It Works</h2>

    <div class="code-block">
      <span class="comment">// 1. Parse TTL ontology</span><br>
      <span class="keyword">const</span> parser = <span class="keyword">new</span> TagTeam.TurtleParser();<br>
      <span class="keyword">const</span> result = parser.parse(ttlContent);<br><br>
      <span class="comment">// 2. Load into OntologyManager</span><br>
      <span class="keyword">const</span> manager = <span class="keyword">new</span> TagTeam.OntologyManager();<br>
      manager.loadFromString(ttlContent, { <span class="property">format</span>: <span class="string">'turtle'</span> });<br><br>
      <span class="comment">// 3. Convert to ValueMatcher format</span><br>
      <span class="keyword">const</span> adapter = <span class="keyword">new</span> TagTeam.ValueNetAdapter(manager);<br>
      <span class="keyword">const</span> matcher = adapter.createValueMatcher();<br><br>
      <span class="comment">// 4. Detect values in text</span><br>
      <span class="keyword">const</span> values = matcher.matchValues(<span class="string">'Protect patient safety'</span>);<br><br>
      <span class="comment">// 5. Load bridge ontology for cross-system mapping</span><br>
      <span class="keyword">const</span> bridge = <span class="keyword">new</span> TagTeam.BridgeOntologyLoader({ <span class="property">ontologyManager</span>: manager });<br>
      bridge.loadFromString(bridgeTTL);<br>
      <span class="keyword">const</span> chain = bridge.getMappingChain(<span class="string">'tagteam:Autonomy'</span>);<br>
      <span class="comment">// { tagteamValue, valuenetDisposition, ieeWorldview }</span>
    </div>
  </div>

  <footer>
    <a href="index.html">&#x2190; Back to Main Demo</a> |
    <a href="phase6-lattice-demo.html">Phase 6: Interpretation Lattice</a> |
    <a href="https://github.com/Skreen5hot/TagTeam.js">GitHub Repository</a>
  </footer>
</div>

<script>
  const scriptPath = window.location.hostname === 'localhost' || window.location.hostname === ''
      ? '../dist/tagteam.js'
      : 'tagteam.js';
  document.write('<script src="' + scriptPath + '"><\/script>');
</script>

<script>
  function escapeHtml(str) {
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // =========================================================================
  // TTL Examples
  // =========================================================================

  const TTL_EXAMPLES = {
    valuenet: `@prefix vn: <https://fandaws.com/ontology/bfo/valuenet#> .
@prefix bfo: <http://purl.obolibrary.org/obo/BFO_> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

vn:SecurityDisposition a bfo:0000016 ;
    rdfs:label "Security" ;
    vn:keywords "safety, stability, protection" ;
    vn:upholdingTerms "protect, secure, safeguard" ;
    vn:violatingTerms "endanger, threaten, risk" .

vn:AutonomyDisposition a bfo:0000016 ;
    rdfs:label "Autonomy" ;
    vn:keywords "choice, freedom, self-determination" ;
    vn:upholdingTerms "respect, empower, enable" ;
    vn:violatingTerms "coerce, force, manipulate" .

vn:BeneficenceDisposition a bfo:0000016 ;
    rdfs:label "Beneficence" ;
    vn:keywords "welfare, wellbeing, benefit, help" ;
    vn:upholdingTerms "care, support, assist" ;
    vn:violatingTerms "neglect, abandon, harm" .`,

    bridge: `@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix tagteam: <https://tagteam.js/ontology/values#> .
@prefix vn: <https://fandaws.com/ontology/bfo/valuenet#> .
@prefix iee: <https://iee.org/ontology/worldview#> .
@prefix ethics: <https://ethics.org/ontology#> .

# TagTeam <-> ValueNet equivalences
tagteam:Autonomy owl:sameAs vn:AutonomyDisposition .
tagteam:Security owl:sameAs vn:SecurityDisposition .
tagteam:Beneficence owl:sameAs vn:BeneficenceDisposition .
tagteam:Justice owl:sameAs vn:JusticeDisposition .

# ValueNet -> IEE worldview mappings
vn:AutonomyDisposition ethics:mapsToWorldview iee:SelfDirectionWorldview .
vn:SecurityDisposition ethics:mapsToWorldview iee:SecurityWorldview .
vn:BeneficenceDisposition ethics:mapsToWorldview iee:BenevolenceWorldview .
vn:JusticeDisposition ethics:mapsToWorldview iee:UniversalismWorldview .

# Related value connections
tagteam:Safety ethics:relatedTo vn:SecurityDisposition .
tagteam:Freedom ethics:relatedTo vn:AutonomyDisposition .
tagteam:Fairness ethics:relatedTo vn:JusticeDisposition .`
  };

  const TEXT_EXAMPLES = {
    upholding: 'We must protect the safety and security of all patients, safeguarding their wellbeing and empowering their choices.',
    violating: 'This policy will endanger safety, coerce patients, and neglect their welfare entirely.',
    mixed: 'The doctor must protect patient safety while respecting autonomy, even though the treatment may threaten their immediate comfort and force difficult choices.'
  };

  // =========================================================================
  // Demo Functions
  // =========================================================================

  function loadTTLExample(type) {
    document.getElementById('ttl-input').value = TTL_EXAMPLES[type];
    parseTTL();
  }

  function setTextExample(type) {
    document.getElementById('text-input').value = TEXT_EXAMPLES[type];
  }

  function parseTTL() {
    const ttl = document.getElementById('ttl-input').value.trim();
    const resultsDiv = document.getElementById('ttl-results');

    if (!ttl) {
      alert('Please enter TTL content to parse.');
      return;
    }

    try {
      const parser = new TagTeam.TurtleParser();
      const result = parser.parse(ttl);

      let html = '';

      // Parse statistics
      html += '<div class="result-card">';
      html += '<h3>&#x2705; Parse Results</h3>';
      html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ffd200;">' + result.triples.length + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Triples</div></div>';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ffd200;">' + Object.keys(result.prefixes).length + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Prefixes</div></div>';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ffd200;">' + result.getSubjects().length + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Subjects</div></div>';

      const valueDefs = result.getAllValueDefinitions ? result.getAllValueDefinitions() : [];
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ffd200;">' + valueDefs.length + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Value Definitions</div></div>';
      html += '</div>';

      // Prefixes
      html += '<h3 style="color: #f7971e; margin-top: 15px;">Prefixes</h3>';
      for (const [prefix, uri] of Object.entries(result.prefixes)) {
        if (['rdf', 'rdfs', 'owl', 'xsd', 'obo', 'cco', 'tagteam'].includes(prefix)) continue;
        html += '<div class="mapping-row">';
        html += '<span class="tag tag-keyword">' + prefix + ':</span>';
        html += '<span class="mapping-arrow">&#x2192;</span>';
        html += '<span style="color: #aaa; font-family: monospace; font-size: 0.9em;">' + uri + '</span>';
        html += '</div>';
      }

      // Value Definitions
      if (valueDefs.length > 0) {
        html += '<h3 style="color: #f7971e; margin-top: 15px;">Value Definitions</h3>';
        for (const vd of valueDefs) {
          html += '<div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 12px;">';
          html += '<div style="font-weight: bold; color: #ffd200; font-size: 1.1em;">' + (vd.label || vd.name) + '</div>';
          if (vd.keywords && vd.keywords.length > 0) {
            html += '<div style="margin-top: 8px;">Keywords: ';
            vd.keywords.forEach(function(k) { html += '<span class="tag tag-keyword">' + k + '</span> '; });
            html += '</div>';
          }
          if (vd.upholdingTerms && vd.upholdingTerms.length > 0) {
            html += '<div style="margin-top: 5px;">Upholding: ';
            vd.upholdingTerms.forEach(function(t) { html += '<span class="tag tag-upholding">' + t + '</span> '; });
            html += '</div>';
          }
          if (vd.violatingTerms && vd.violatingTerms.length > 0) {
            html += '<div style="margin-top: 5px;">Violating: ';
            vd.violatingTerms.forEach(function(t) { html += '<span class="tag tag-violating">' + t + '</span> '; });
            html += '</div>';
          }
          html += '</div>';
        }
      }

      // Raw triples
      html += '<details style="margin-top: 15px;">';
      html += '<summary style="cursor: pointer; color: #f7971e; font-weight: bold;">View Raw Triples (' + result.triples.length + ')</summary>';
      html += '<div class="json-output" style="margin-top: 10px;">' + JSON.stringify(result.triples, null, 2) + '</div>';
      html += '</details>';

      html += '</div>';

      resultsDiv.innerHTML = html;
      resultsDiv.classList.add('show');

    } catch (e) {
      resultsDiv.innerHTML = '<div class="result-card" style="border-left-color: #ff6b6b;"><h3 style="color: #ff6b6b;">Error</h3><p>' + escapeHtml(e.message) + '</p></div>';
      resultsDiv.classList.add('show');
      console.error(e);
    }
  }

  function detectValues() {
    const ttl = document.getElementById('ttl-input').value.trim();
    const text = document.getElementById('text-input').value.trim();
    const resultsDiv = document.getElementById('value-results');

    if (!ttl || !text) {
      alert('Please enter both TTL content and text to analyze.');
      return;
    }

    try {
      // Step 1: Load into OntologyManager
      var manager = new TagTeam.OntologyManager();
      manager.loadFromString(ttl, { format: 'turtle', namespace: 'vn' });

      // Step 2: Create ValueNetAdapter
      var adapter = new TagTeam.ValueNetAdapter(manager);
      var converted = adapter.getAllAsValueMatcherFormat();

      // Step 3: Create ValueMatcher and detect
      var matcher = adapter.createValueMatcher();
      var values = matcher.matchValues(text);

      let html = '';

      // Conversion summary
      html += '<div class="result-card">';
      html += '<h3>&#x1F504; Ontology Conversion</h3>';
      html += '<p style="color: #aaa; margin-bottom: 15px;">Converted ' + converted.length + ' value definitions from TTL to ValueMatcher format.</p>';

      for (var i = 0; i < converted.length; i++) {
        var cv = converted[i];
        html += '<div class="mapping-row">';
        html += '<span class="tag tag-valuenet">' + cv.name + '</span>';
        html += '<span style="color: #888; font-size: 0.85em;">';
        html += cv.semanticMarkers.length + ' markers, ';
        html += (cv.polarityIndicators.upholding.length + cv.polarityIndicators.violating.length) + ' polarity terms';
        html += '</span>';
        html += '</div>';
      }
      html += '</div>';

      // Detection results
      html += '<div class="result-card">';
      html += '<h3>&#x1F50D; Value Detection Results</h3>';
      html += '<p style="color: #aaa; margin-bottom: 15px;">Found ' + values.length + ' values in text.</p>';

      if (values.length > 0) {
        for (var j = 0; j < values.length; j++) {
          var v = values[j];
          var polarityColor = v.polarity > 0 ? '#00ff88' : v.polarity < 0 ? '#ff6b6b' : '#ffd200';
          var polarityLabel = v.polarity > 0 ? 'UPHOLDING' : v.polarity < 0 ? 'VIOLATING' : 'NEUTRAL';

          html += '<div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 12px; border-left: 4px solid ' + polarityColor + ';">';
          html += '<div style="display: flex; justify-content: space-between; align-items: center;">';
          html += '<span style="font-weight: bold; color: #ffd200; font-size: 1.1em;">' + v.name + '</span>';
          html += '<span style="color: ' + polarityColor + '; font-weight: bold; font-size: 0.85em;">' + polarityLabel + ' (' + (v.polarity > 0 ? '+' : '') + v.polarity + ')</span>';
          html += '</div>';
          if (v.matchedKeywords && v.matchedKeywords.length > 0) {
            html += '<div style="margin-top: 8px; color: #888;">Matched: ' + v.matchedKeywords.join(', ') + '</div>';
          }
          html += '<div style="margin-top: 5px;">';
          html += '<div style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">';
          html += '<div style="height: 100%; width: ' + (v.score * 100) + '%; background: ' + polarityColor + '; border-radius: 3px;"></div>';
          html += '</div>';
          html += '<div style="color: #666; font-size: 0.8em; margin-top: 3px;">Score: ' + (v.score * 100).toFixed(0) + '%</div>';
          html += '</div>';
          html += '</div>';
        }
      } else {
        html += '<p style="color: #888;">No values detected. Make sure the text contains keywords from the loaded ontology.</p>';
      }

      html += '</div>';

      // Full JSON
      html += '<details style="margin-top: 15px;">';
      html += '<summary style="cursor: pointer; color: #f7971e; font-weight: bold;">View Full JSON Output</summary>';
      html += '<div class="json-output" style="margin-top: 10px;">' + JSON.stringify(values, null, 2) + '</div>';
      html += '</details>';

      resultsDiv.innerHTML = html;
      resultsDiv.classList.add('show');

    } catch (e) {
      resultsDiv.innerHTML = '<div class="result-card" style="border-left-color: #ff6b6b;"><h3 style="color: #ff6b6b;">Error</h3><p>' + escapeHtml(e.message) + '</p></div>';
      resultsDiv.classList.add('show');
      console.error(e);
    }
  }

  function demoBridge() {
    var resultsDiv = document.getElementById('bridge-results');

    try {
      // Load ValueNet first
      var manager = new TagTeam.OntologyManager();
      manager.loadFromString(TTL_EXAMPLES.valuenet, { format: 'turtle', namespace: 'vn' });

      // Load bridge ontology
      var bridge = new TagTeam.BridgeOntologyLoader({ ontologyManager: manager });
      var loadResult = bridge.loadFromString(TTL_EXAMPLES.bridge);

      var html = '';

      // Load summary
      html += '<div class="result-card">';
      html += '<h3>&#x2705; Bridge Ontology Loaded</h3>';
      html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ffd200;">' + loadResult.mappingCount + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Total Mappings</div></div>';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #667eea;">' + loadResult.equivalenceCount + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Equivalences</div></div>';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #00ff88;">' + (loadResult.worldviewCount || 0) + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Worldview Maps</div></div>';
      html += '<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">';
      html += '<div style="font-size: 1.8em; font-weight: bold; color: #ff6b6b;">' + (loadResult.relatedCount || 0) + '</div>';
      html += '<div style="color: #888; font-size: 0.85em;">Related</div></div>';
      html += '</div>';
      html += '</div>';

      // Mapping chains
      var tagteamValues = ['tagteam:Autonomy', 'tagteam:Security', 'tagteam:Beneficence', 'tagteam:Justice'];

      html += '<div class="result-card">';
      html += '<h3>&#x1F517; Mapping Chains: TagTeam &#x2192; ValueNet &#x2192; IEE</h3>';

      for (var i = 0; i < tagteamValues.length; i++) {
        var chain = bridge.getMappingChain(tagteamValues[i]);
        var localName = tagteamValues[i].split(':')[1];
        var vnName = chain.valuenetDisposition ? chain.valuenetDisposition.split(':').pop() : 'N/A';
        var ieeName = chain.ieeWorldview ? chain.ieeWorldview.split(':').pop() : 'N/A';

        html += '<div class="mapping-row">';
        html += '<span class="tag tag-tagteam">' + localName + '</span>';
        html += '<span class="mapping-arrow">&#x2192;</span>';
        html += '<span class="tag tag-valuenet">' + vnName + '</span>';
        html += '<span class="mapping-arrow">&#x2192;</span>';
        if (chain.ieeWorldview) {
          html += '<span class="tag tag-iee">' + ieeName + '</span>';
        } else {
          html += '<span style="color: #666;">No worldview mapped</span>';
        }
        html += '</div>';
      }
      html += '</div>';

      // Related values
      var relatedMappings = bridge.getRelatedMappings();
      if (relatedMappings.length > 0) {
        html += '<div class="result-card">';
        html += '<h3>&#x1F4A1; Related Value Connections</h3>';
        for (var r = 0; r < relatedMappings.length; r++) {
          var rm = relatedMappings[r];
          html += '<div class="mapping-row">';
          html += '<span class="tag tag-tagteam">' + rm.source.split(':').pop() + '</span>';
          html += '<span style="color: #888; font-style: italic; font-size: 0.85em;">related to</span>';
          html += '<span class="tag tag-valuenet">' + rm.target.split(':').pop() + '</span>';
          html += '</div>';
        }
        html += '</div>';
      }

      // Full JSON export
      html += '<details style="margin-top: 15px;">';
      html += '<summary style="cursor: pointer; color: #f7971e; font-weight: bold;">View Full Bridge Export (JSON)</summary>';
      html += '<div class="json-output" style="margin-top: 10px;">' + JSON.stringify(bridge.toJSON(), null, 2) + '</div>';
      html += '</details>';

      resultsDiv.innerHTML = html;
      resultsDiv.classList.add('show');

    } catch (e) {
      resultsDiv.innerHTML = '<div class="result-card" style="border-left-color: #ff6b6b;"><h3 style="color: #ff6b6b;">Error</h3><p>' + escapeHtml(e.message) + '</p></div>';
      resultsDiv.classList.add('show');
      console.error(e);
    }
  }

  // Debug info
  window.addEventListener('load', function() {
    console.log('TagTeam version:', TagTeam.version);
    console.log('TurtleParser available:', typeof TagTeam.TurtleParser !== 'undefined');
    console.log('OntologyManager available:', typeof TagTeam.OntologyManager !== 'undefined');
    console.log('ValueNetAdapter available:', typeof TagTeam.ValueNetAdapter !== 'undefined');
    console.log('BridgeOntologyLoader available:', typeof TagTeam.BridgeOntologyLoader !== 'undefined');
  });
</script>

</body>
</html>
