<!DOCTYPE html>
<html lang="en">
<head><base href="/TagTeam.js/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TagTeam.js - IEE Test Corpus Validation (Bundle)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f9fafb;
    }
    h1 {
      color: #1f2937;
      border-bottom: 3px solid #3b82f6;
      padding-bottom: 10px;
    }
    .info {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .scenario {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .scenario h3 {
      margin-top: 0;
      color: #3b82f6;
    }
    .pass {
      background: #d1fae5;
      border-left: 4px solid #10b981;
      padding: 10px;
      margin: 10px 0;
    }
    .fail {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 10px;
      margin: 10px 0;
    }
    .result {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px 10px 0;
    }
    button:hover {
      background: #2563eb;
    }
    .summary {
      background: white;
      border: 2px solid #3b82f6;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .summary h2 {
      margin-top: 0;
      color: #1f2937;
    }
  </style>
</head>
<body>
  <h1>üéØ TagTeam.js - IEE Test Corpus Validation</h1>

  <div class="info">
    <strong>Bundle Test Version</strong><br>
    This page uses the single-file <code>tagteam.js</code> bundle with the simple <code>TagTeam.parse()</code> API.<br>
    Testing against IEE's 5 official Week 1 scenarios.
  </div>

  <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
  <button onclick="location.reload()">üîÑ Reset</button>

  <div id="summary"></div>
  <div id="results"></div>

  <!-- Load the bundle -->
  <script src="tagteam.js"></script>

  <script>
    // IEE Test Corpus (from test-corpus-week1.json)
    const testScenarios = [
      {
        id: "healthcare-001",
        title: "End of Life Decision",
        description: "A 78-year-old patient with terminal cancer is on life support with no chance of recovery. The family must decide whether to continue treatment.",
        testSentence: "The family must decide whether to continue treatment",
        expected: {
          agent: "family",
          action: "decide",
          modality: "must",
          frame: "Deciding"
        }
      },
      {
        id: "spiritual-001",
        title: "Leaving Faith Community",
        description: "After 30 years in a conservative religious community, I am questioning core doctrines and considering leaving.",
        testSentence: "I am questioning core doctrines",
        expected: {
          agent: "I",
          action: "question",
          patient: "doctrines",
          frame: "Questioning"
        }
      },
      {
        id: "vocational-001",
        title: "Whistleblowing Decision",
        description: "I discovered that my company is falsifying safety reports.",
        testSentence: "I discovered that my company is falsifying safety reports",
        expected: {
          agent: "I",
          action: "discover",
          frame: "Becoming_aware"
        }
      },
      {
        id: "interpersonal-001",
        title: "Friend's Infidelity",
        description: "My best friend is cheating on their spouse.",
        testSentence: "My best friend is cheating on their spouse",
        expected: {
          agent: "friend",
          action: "cheat",
          patient: "spouse",
          frame: "Offenses"
        }
      },
      {
        id: "environmental-001",
        title: "Climate Action vs Economic Impact",
        description: "We must decide whether to allow an extension for the coal plant.",
        testSentence: "We must decide whether to allow an extension",
        expected: {
          agent: "We",
          action: "decide",
          modality: "must",
          frame: "Deciding"
        }
      }
    ];

    function runAllTests() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      let passed = 0;
      let failed = 0;
      const failures = [];

      testScenarios.forEach((scenario, index) => {
        console.log(`Testing scenario ${index + 1}: ${scenario.title}`);

        const result = TagTeam.parse(scenario.testSentence);

        const scenarioDiv = document.createElement('div');
        scenarioDiv.className = 'scenario';

        let html = `
          <h3>${scenario.id}: ${scenario.title}</h3>
          <p><strong>Description:</strong> ${scenario.description}</p>
          <p><strong>Test Sentence:</strong> "${scenario.testSentence}"</p>
        `;

        // Validate results
        const checks = [];

        // Agent check
        if (scenario.expected.agent) {
          const agentText = result.agent ? result.agent.text.toLowerCase() : '';
          const match = agentText.includes(scenario.expected.agent.toLowerCase());
          checks.push({
            name: 'Agent',
            expected: scenario.expected.agent,
            actual: result.agent ? result.agent.text : 'null',
            pass: match
          });
        }

        // Action check
        if (scenario.expected.action) {
          const actionVerb = result.action ? result.action.verb : '';
          const match = actionVerb === scenario.expected.action ||
                       (result.action && result.action.verbOriginal === scenario.expected.action);
          checks.push({
            name: 'Action',
            expected: scenario.expected.action,
            actual: actionVerb || 'null',
            pass: match
          });
        }

        // Modality check
        if (scenario.expected.modality) {
          const modality = result.action ? result.action.modality : null;
          const match = modality === scenario.expected.modality;
          checks.push({
            name: 'Modality',
            expected: scenario.expected.modality,
            actual: modality || 'null',
            pass: match
          });
        }

        // Patient check
        if (scenario.expected.patient) {
          const patientText = result.patient ? result.patient.text.toLowerCase() : '';
          const match = patientText.includes(scenario.expected.patient.toLowerCase());
          checks.push({
            name: 'Patient',
            expected: scenario.expected.patient,
            actual: result.patient ? result.patient.text : 'null',
            pass: match
          });
        }

        // Frame check
        if (scenario.expected.frame) {
          const frame = result.semanticFrame || result.action?.frame;
          const match = frame === scenario.expected.frame;
          checks.push({
            name: 'Frame',
            expected: scenario.expected.frame,
            actual: frame || 'null',
            pass: match
          });
        }

        // Display checks
        checks.forEach(check => {
          const className = check.pass ? 'pass' : 'fail';
          html += `
            <div class="${className}">
              ${check.pass ? '‚úÖ' : '‚ùå'} <strong>${check.name}:</strong>
              Expected "${check.expected}", Got "${check.actual}"
            </div>
          `;
          if (check.pass) {
            passed++;
          } else {
            failed++;
            failures.push(`${scenario.id} - ${check.name}`);
          }
        });

        html += `
          <div class="result">
            <strong>Full Parse Result:</strong><br>
            <pre>${JSON.stringify(result, null, 2)}</pre>
          </div>
        `;

        scenarioDiv.innerHTML = html;
        resultsDiv.appendChild(scenarioDiv);
      });

      // Display summary
      const totalChecks = passed + failed;
      const passRate = ((passed / totalChecks) * 100).toFixed(1);
      const summaryDiv = document.getElementById('summary');

      summaryDiv.innerHTML = `
        <div class="summary">
          <h2>üìä Test Summary</h2>
          <p><strong>Total Checks:</strong> ${totalChecks}</p>
          <p><strong>Passed:</strong> ${passed} ‚úÖ</p>
          <p><strong>Failed:</strong> ${failed} ‚ùå</p>
          <p><strong>Pass Rate:</strong> ${passRate}%</p>
          <p><strong>Target:</strong> ‚â•75% (Week 1)</p>
          <p style="font-size: 20px; margin-top: 15px;">
            ${passRate >= 75 ? 'üéâ <strong style="color: #10b981;">PASSING</strong>' : '‚ö†Ô∏è <strong style="color: #ef4444;">NEEDS WORK</strong>'}
          </p>
          ${failures.length > 0 ? `
            <div style="margin-top: 15px;">
              <strong>Failed Checks:</strong>
              <ul>
                ${failures.map(f => `<li>${f}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
        </div>
      `;
    }

    // Display TagTeam version
    console.log('TagTeam.js Bundle loaded! Version:', TagTeam.version);
  </script>
</body>
</html>
