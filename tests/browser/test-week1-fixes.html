<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Week 1 Fixes Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case.pass {
            border-left-color: #27ae60;
        }
        .test-case.fail {
            border-left-color: #e74c3c;
        }
        .test-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .sentence {
            background: #ecf0f1;
            padding: 8px;
            margin: 8px 0;
            border-radius: 3px;
            font-family: monospace;
        }
        .check {
            margin: 5px 0;
            padding-left: 20px;
        }
        .pass { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .summary {
            background: #34495e;
            color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .summary h2 {
            margin-top: 0;
        }
        .summary .pass-rate {
            font-size: 2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Week 1 Fixes Validation Test</h1>
    <p>Testing the 7 failing checks from IEE validation report</p>

    <div id="results"></div>
    <div id="summary" class="summary"></div>

    <!-- Use the bundled version instead of individual source files -->
    <script src="dist/tagteam.js"></script>

    <script>
        // The bundle exposes TagTeam.parse(), but we need the internal extractor for detailed testing
        // For now, use TagTeam.parse() and adapt our tests

        function parseWithDetails(sentence) {
            return TagTeam.parse(sentence);
        }

        const tests = [
            {
                id: 'healthcare-001',
                name: 'Healthcare - Agent Extraction',
                sentence: 'The family must decide whether to continue treatment',
                checks: [
                    { type: 'agent', expected: 'family', path: 'agent.text' }
                ]
            },
            {
                id: 'spiritual-001',
                name: 'Spiritual - Progressive Verb & Frame',
                sentence: 'I am questioning core doctrines',
                checks: [
                    { type: 'action', expected: 'questioning', path: 'action.verb' },
                    { type: 'frame', expected: 'Questioning', path: 'semanticFrame' }
                ]
            },
            {
                id: 'vocational-001',
                name: 'Vocational - Lemmatization & Frame',
                sentence: 'I discovered that my company is falsifying safety reports',
                checks: [
                    { type: 'action-lemma', expected: 'discover', path: 'action.lemma' },
                    { type: 'frame', expected: 'Becoming_aware', path: 'semanticFrame' }
                ]
            },
            {
                id: 'interpersonal-001',
                name: 'Interpersonal - Progressive Verb & Frame',
                sentence: 'My best friend is cheating on their spouse',
                checks: [
                    { type: 'action', expected: 'cheating', path: 'action.verb' },
                    { type: 'frame', expected: 'Offenses', path: 'semanticFrame' }
                ]
            }
        ];

        function getValue(obj, path) {
            return path.split('.').reduce((curr, prop) => curr?.[prop], obj);
        }

        let totalChecks = 0;
        let passedChecks = 0;

        const resultsDiv = document.getElementById('results');

        tests.forEach(test => {
            const result = TagTeam.parse(test.sentence);

            let testHtml = `
                <div class="test-case">
                    <div class="test-title">${test.id}: ${test.name}</div>
                    <div class="sentence">"${test.sentence}"</div>
            `;

            let allPassed = true;

            test.checks.forEach(check => {
                totalChecks++;
                const actual = getValue(result, check.path);
                const passed = actual === check.expected;

                if (passed) passedChecks++;
                else allPassed = false;

                testHtml += `
                    <div class="check ${passed ? 'pass' : 'fail'}">
                        ${passed ? '✅' : '❌'} ${check.type}:
                        Expected "${check.expected}", Got "${actual || 'null'}"
                    </div>
                `;
            });

            testHtml += `</div>`;

            const testDiv = document.createElement('div');
            testDiv.innerHTML = testHtml;
            testDiv.firstElementChild.classList.add(allPassed ? 'pass' : 'fail');
            resultsDiv.appendChild(testDiv.firstElementChild);
        });

        const passRate = ((passedChecks / totalChecks) * 100).toFixed(1);
        const summaryDiv = document.getElementById('summary');

        summaryDiv.innerHTML = `
            <h2>Test Summary</h2>
            <div class="pass-rate">${passRate}%</div>
            <div>Pass Rate (${passedChecks}/${totalChecks} checks)</div>
            <div style="margin-top: 10px;">
                ${passRate >= 100 ? '✅ PERFECT! All fixes working!' :
                  passRate >= 85 ? '✅ EXCELLENT! Exceeds Phase 2 trigger (85%)' :
                  passRate >= 75 ? '✅ PASS! Meets Week 1 target (75%)' :
                  '⚠️ NEEDS WORK - Below Week 1 target (75%)'}
            </div>
        `;
    </script>
</body>
</html>
